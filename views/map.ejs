<style>
    body {
      margin: 0;
    }
  </style>
  <body onload="load()">
    <div id="map" style="width: 100%; height: 100vh;"></div>
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=49ae370ae9f520ffdbf60c3ca2e7b0c1&libraries=services"
    ></script>
    <script>
      // 동의
      function successCallback(position) {
// 현재 좌표 중심좌표
// position.coords.latitude,position.coords.longitude	
      var mapContainer = document.getElementById("map"), // 지도를 표시할 div
        mapOption = {
          center: new kakao.maps.LatLng(37.486868162882, 127.08303697984), // 지도의 중심좌표
          level: 4, // 지도의 확대 레벨
        };

      var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

      var geocoder = new kakao.maps.services.Geocoder();

      var bounds = map.getBounds();
      // 영역의 남서쪽 좌표를 얻어옵니다
      var swLatLng = bounds.getSouthWest();

      // 영역의 북동쪽 좌표를 얻어옵니다
      var neLatLng = bounds.getNorthEast();

      const data = {
          rightLatitude: neLatLng.getLat(),
          rightLongitude: neLatLng.getLng(),
          leftLatitude: swLatLng.getLat(),
          leftLongitude: swLatLng.getLng(),
      };
      

        fetch(`http://localhost:3000/api/hospitals/around`, {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),})
        .then((response) => response.json())
        .then((data) => {
          console.log(data)
          if (data.hospitals[0]) {
            for (let i = 0; i < data.hospitals.length; i++) {
            geocoder.addressSearch(
              data.hospitals[i].address,
              function (result, status) {
                // 정상적으로 검색이 완료됐으면
                if (status === kakao.maps.services.Status.OK) {
                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
  
                // 결과값으로 받은 위치를 마커로 표시합니다
                var marker = new kakao.maps.Marker({
                  map: map,
                  position: coords,
                });
  
              // 인포윈도우로 장소에 대한 설명을 표시합니다
              var infowindow = new kakao.maps.InfoWindow({
                content:
                  `<div style="width:150px;text-align:center;padding:6px 0;">${data.hospitals[i].name}</div>`,
              });
              infowindow.open(map, marker);
  
              // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
              map.setCenter(coords);
            }
          }
        );
      }
          }
        })


}

// 동의 X
function errorCallback(error) {

alert(error.message);

}


function load(){ 

if ( navigator.geolocation ) {

  navigator.geolocation.getCurrentPosition(successCallback, errorCallback);

} else {

  alert("geolocation not supported");

}

}
    </script>
  </body>
</html>
